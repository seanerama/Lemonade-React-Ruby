# Render Blueprint for Lemonade Game
# This file defines all the infrastructure needed to deploy the app

# Database is shared with US States Game project (states-game-db)
# Using existing PostgreSQL server with lemonade_production database

services:
  # Rails API Backend
  - type: web
    name: lemonade-backend
    runtime: docker
    plan: free  # Free tier spins down after 15min inactivity
    region: ohio  # Should match database region
    rootDir: lemonade-backend
    dockerfilePath: ./Dockerfile
    healthCheckPath: /api/leaderboard
    envVars:
      - key: RAILS_ENV
        value: production
      - key: DATABASE_URL
        value: postgresql://states_game_db_user:zw6nGBmMvbrAAwOfMXBfT3ykWmxwzB56@dpg-d3qgn5vdiees73ac4q8g-a.oregon-postgres.render.com/lemonade_production
      - key: RAILS_MASTER_KEY
        sync: false  # Add this manually in Render Dashboard (from lemonade-backend/config/master.key)
      - key: RAILS_LOG_TO_STDOUT
        value: true
      - key: RAILS_SERVE_STATIC_FILES
        value: true
      - key: CORS_ORIGINS
        value: https://lemonade-frontend.onrender.com  # Update with your actual frontend URL after first deploy

  # React Frontend
  - type: web
    name: lemonade-frontend
    runtime: static
    rootDir: lemonade-frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: ./build
    headers:
      - path: /*
        name: Cache-Control
        value: public, max-age=0, must-revalidate
      - path: /static/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
    envVars:
      - key: NODE_VERSION
        value: 18  # Specify Node version

# Notes:
# 1. The frontend uses runtime config from public/config.js for the API URL
# 2. Update public/config.js if your backend URL changes
# 3. Add RAILS_MASTER_KEY manually in Render Dashboard (don't commit this file!)
# 4. Free tier services spin down after 15 minutes of inactivity
# 5. First request after spin-down takes 30-60 seconds
# 6. Consider upgrading to paid plans for production use
